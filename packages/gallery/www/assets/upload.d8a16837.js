import{i as a}from"./vendor.2a83d1c9.js";import{C as f}from"./index.b1c16674.js";function E(r){if(!r)return"";if(r.message)return r.message;const t=r.target;return t?r.target.error&&r.target.error.message?t.error.message:r.target.src?`Failed to load "${t.src}"`:t instanceof XMLHttpRequest?`Network Error: ${t.status||"Unknown Status."} ${t.statusText||"Unknown Error. Possibly a CORS error."}`:`Unknown error on ${t}.`:`Unknown error: "${JSON.stringify(r)}"`}class g extends Error{constructor(t){super(t);this.name=this.constructor.name,this.message=t,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(t).stack}}class w extends g{originalError;constructor(t,e){super(`${t}:
  Cause:
    ${E(e).replace(/\n/g,`
    `)}`);this.originalError=e,this.stack+=`
`+e.stack}}const h=()=>{const r=localStorage.getItem(f.publicRuntimeConfig.feathersStoreKey);if(r==null||r.length===0)throw new Error(a.t("editor:errors.notAuthenticated"));return r},p=f.publicRuntimeConfig.apiServer,$=async(r,t,e,c,d)=>{const l=h();return await new Promise((m,i)=>{const o=new XMLHttpRequest,u=()=>{o.abort();const s=new Error(a.t("editor:errors.uploadAborted"));s.name="AbortError",s.aborted=!0,i(s)};e&&e.addEventListener("abort",u),console.log("Posting to: ",`${p}/media`),o.open("post",`${p}/media`,!0),o.upload.addEventListener("progress",s=>{t&&t(s.loaded/s.total)}),o.addEventListener("error",s=>{e&&e.removeEventListener("abort",u),i(new w(a.t("editor:errors.uploadFailed"),s))}),o.addEventListener("load",()=>{if(e&&e.removeEventListener("abort",u),o.status<300){const s=JSON.parse(o.responseText);m(s)}else i(new Error(a.t("editor:errors.uploadFailed",{reason:o.statusText})))});const n=new FormData;d&&n.set("projectId",d),c&&n.set("fileIdentifier",c),n.set("media",r),o.setRequestHeader("Authorization",`Bearer ${l}`),o.send(n)})};export{$ as u};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLmQ4YTE2ODM3LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9lbmdpbmUvc3JjL3NjZW5lL2Z1bmN0aW9ucy9lcnJvcnMudHMiLCIuLi8uLi8uLi9lbmdpbmUvc3JjL3NjZW5lL2Z1bmN0aW9ucy9nZXRUb2tlbi50c3giLCIuLi8uLi8uLi9lbmdpbmUvc3JjL3NjZW5lL2Z1bmN0aW9ucy91cGxvYWQudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGV2ZW50VG9NZXNzYWdlKGV2ZW50KSB7XG4gIGlmICghZXZlbnQpIHJldHVybiAnJ1xuICBpZiAoZXZlbnQubWVzc2FnZSkgcmV0dXJuIGV2ZW50Lm1lc3NhZ2VcbiAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0XG4gIGlmICh0YXJnZXQpIHtcbiAgICBpZiAoZXZlbnQudGFyZ2V0LmVycm9yICYmIGV2ZW50LnRhcmdldC5lcnJvci5tZXNzYWdlKSByZXR1cm4gdGFyZ2V0LmVycm9yLm1lc3NhZ2VcbiAgICBpZiAoZXZlbnQudGFyZ2V0LnNyYykgcmV0dXJuIGBGYWlsZWQgdG8gbG9hZCBcIiR7dGFyZ2V0LnNyY31cImBcbiAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgWE1MSHR0cFJlcXVlc3QpIHtcbiAgICAgIHJldHVybiBgTmV0d29yayBFcnJvcjogJHt0YXJnZXQuc3RhdHVzIHx8ICdVbmtub3duIFN0YXR1cy4nfSAke1xuICAgICAgICB0YXJnZXQuc3RhdHVzVGV4dCB8fCAnVW5rbm93biBFcnJvci4gUG9zc2libHkgYSBDT1JTIGVycm9yLidcbiAgICAgIH1gXG4gICAgfVxuICAgIHJldHVybiBgVW5rbm93biBlcnJvciBvbiAke3RhcmdldH0uYFxuICB9XG4gIHJldHVybiBgVW5rbm93biBlcnJvcjogXCIke0pTT04uc3RyaW5naWZ5KGV2ZW50KX1cImBcbn1cbi8vIEJhc2UgZXJyb3IgY2xhc3MgdG8gYmUgdXNlZCBmb3IgYWxsIGN1c3RvbSBlcnJvcnMuXG5leHBvcnQgY2xhc3MgQmFzZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlKSB7XG4gICAgc3VwZXIobWVzc2FnZSlcbiAgICB0aGlzLm5hbWUgPSB0aGlzLmNvbnN0cnVjdG9yLm5hbWVcbiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlXG4gICAgaWYgKHR5cGVvZiBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgdGhpcy5jb25zdHJ1Y3RvcilcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdGFjayA9IG5ldyBFcnJvcihtZXNzYWdlKS5zdGFja1xuICAgIH1cbiAgfVxufVxuLy8gT3ZlcnJpZGUgdGhlIG1lc3NhZ2Ugb2YgYW4gZXJyb3IgYnV0IGFwcGVuZCB0aGUgZXhpc3Rpbmcgc3RhY2sgdHJhY2UuXG5leHBvcnQgY2xhc3MgUmV0aHJvd25FcnJvciBleHRlbmRzIEJhc2VFcnJvciB7XG4gIG9yaWdpbmFsRXJyb3JcbiAgY29uc3RydWN0b3IobWVzc2FnZSwgZXJyb3IpIHtcbiAgICBzdXBlcihgJHttZXNzYWdlfTpcXG4gIENhdXNlOlxcbiAgICAke2V2ZW50VG9NZXNzYWdlKGVycm9yKS5yZXBsYWNlKC9cXG4vZywgJ1xcbiAgICAnKX1gKVxuICAgIHRoaXMub3JpZ2luYWxFcnJvciA9IGVycm9yXG4gICAgdGhpcy5zdGFjayArPSAnXFxuJyArIGVycm9yLnN0YWNrXG4gIH1cbn1cbi8vIE91dHB1dCBtZXNzYWdlcyBmb3IgbXVsdGlwbGUgZXJyb3JzLlxuLy9cbi8vIEV4YW1wbGU6IG5ldyBNdWx0aUVycm9yKFwiRXJyb3IgbG9hZGluZyBwcm9qZWN0XCIsIGVycm9ycyk7XG4vLyBPdXRwdXQ6XG4vLyAgRXJyb3IgbG9hZGluZyBwcm9qZWN0OlxuLy9cbi8vICAyIEVycm9yczpcbi8vICAgIE1vZGVsIFwiRXhhbXBsZSBNb2RlbFwiIGNvdWxkIG5vdCBiZSBsb2FkZWQ6XG4vLyAgICAgIENhdXNlOlxuLy8gICAgICAgIE5ldHdvcmsgRXJyb3I6IFVua25vd24gZXJyb3IuIFBvc3NpYmx5IGNhdXNlZCBieSBpbXByb3BlciBDT1JTIGhlYWRlcnMuXG4vLyAgICBJbWFnZSBcIkV4YW1wbGUgSW1hZ2VcIiBjb3VsZCBub3QgYmUgbG9hZGVkLlxuLy8gICAgICBOZXR3b3JrIEVycm9yOiA0MDQgUGFnZSBub3QgZm91bmQuXG5leHBvcnQgY2xhc3MgTXVsdGlFcnJvciBleHRlbmRzIEJhc2VFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIGVycm9ycykge1xuICAgIGxldCBmaW5hbE1lc3NhZ2UgPSBgJHttZXNzYWdlfTpcXG5cXG4ke2Vycm9ycy5sZW5ndGh9IEVycm9yJHtlcnJvcnMubGVuZ3RoID4gMSA/ICdzJyA6ICcnfTpgXG4gICAgZm9yIChjb25zdCBlcnJvciBvZiBlcnJvcnMpIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGVycm9yLm1lc3NhZ2UgPyBlcnJvci5tZXNzYWdlLnJlcGxhY2UoL1xcbi9nLCAnXFxuICAnKSA6ICdVbmtub3duIEVycm9yJ1xuICAgICAgZmluYWxNZXNzYWdlICs9ICdcXG4gICcgKyBlcnJvck1lc3NhZ2VcbiAgICB9XG4gICAgc3VwZXIoZmluYWxNZXNzYWdlKVxuICB9XG59XG4iLCJpbXBvcnQgaTE4biBmcm9tICdpMThuZXh0J1xuaW1wb3J0IHsgQ29uZmlnIH0gZnJvbSAnQHhyZW5naW5lL2NvbW1vbi9zcmMvY29uZmlnJ1xuXG4vKipcbiAqIGdldFRva2VuIHVzZWQgdG8gZ2V0IHRoZSB0b2tlbiBvZiBsb2dpbmVkIHVzZXIuXG4gKlxuICogQGF1dGhvciBSb2JlcnQgTG9uZ1xuICogQHJldHVybiB7c3RyaW5nfSAgICAgICAgW3JldHVybnMgdG9rZW4gc3RyaW5nXVxuICovXG5cbmV4cG9ydCBjb25zdCBnZXRUb2tlbiA9ICgpOiBzdHJpbmcgPT4ge1xuICBjb25zdCB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKENvbmZpZy5wdWJsaWNSdW50aW1lQ29uZmlnLmZlYXRoZXJzU3RvcmVLZXkpXG5cbiAgaWYgKHRva2VuID09IG51bGwgfHwgdG9rZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGkxOG4udCgnZWRpdG9yOmVycm9ycy5ub3RBdXRoZW50aWNhdGVkJykpXG4gIH1cblxuICByZXR1cm4gdG9rZW5cbn1cbiIsImltcG9ydCB7IFJldGhyb3duRXJyb3IgfSBmcm9tICcuLi8uLi9zY2VuZS9mdW5jdGlvbnMvZXJyb3JzJ1xuaW1wb3J0IGkxOG4gZnJvbSAnaTE4bmV4dCdcbmltcG9ydCB7IEF1ZGlvRmlsZVR5cGVzLCBDdXN0b21TY3JpcHRGaWxlVHlwZXMgfSBmcm9tICcuLi8uLi9hc3NldHMvY29uc3RhbnRzL2ZpbGVUeXBlcydcbmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAnLi9nZXRUb2tlbidcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gJ0B4cmVuZ2luZS9jb21tb24vc3JjL2NvbmZpZydcblxuY29uc3Qgc2VydmVyVVJMID0gQ29uZmlnLnB1YmxpY1J1bnRpbWVDb25maWcuYXBpU2VydmVyXG5cbmxldCBsYXN0VXBsb2FkQXNzZXRSZXF1ZXN0ID0gMFxuXG4vKipcbiAqIHVwbG9hZCB1c2VkIHRvIHVwbG9hZCBpbWFnZSBhcyBibG9iIGRhdGEuXG4gKlxuICogQGF1dGhvciBSb2JlcnQgTG9uZ1xuICogQHBhcmFtICB7YW55fSAgYmxvYlxuICogQHBhcmFtICB7YW55fSAgb25VcGxvYWRQcm9ncmVzc1xuICogQHBhcmFtICB7YW55fSAgc2lnbmFsXG4gKiBAcGFyYW0gIHthbnl9ICBwcm9qZWN0SWRcbiAqIEBwYXJhbSAge3N0cmluZ30gIGZpbGVJZGVudGlmaWVyXG4gKiBAcmV0dXJuIHtQcm9taXNlfVxuICovXG5cbmV4cG9ydCBjb25zdCB1cGxvYWQgPSBhc3luYyAoYmxvYiwgb25VcGxvYWRQcm9ncmVzcywgc2lnbmFsPywgZmlsZUlkZW50aWZpZXI/LCBwcm9qZWN0SWQ/KTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gIGNvbnN0IHRva2VuID0gZ2V0VG9rZW4oKVxuXG4gIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpXG4gICAgY29uc3Qgb25BYm9ydCA9ICgpID0+IHtcbiAgICAgIHJlcXVlc3QuYWJvcnQoKVxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoaTE4bi50KCdlZGl0b3I6ZXJyb3JzLnVwbG9hZEFib3J0ZWQnKSlcbiAgICAgIGVycm9yLm5hbWUgPSAnQWJvcnRFcnJvcidcbiAgICAgIGVycm9yWydhYm9ydGVkJ10gPSB0cnVlXG4gICAgICByZWplY3QoZXJyb3IpXG4gICAgfVxuXG4gICAgaWYgKHNpZ25hbCkge1xuICAgICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0Jywgb25BYm9ydClcbiAgICB9XG4gICAgY29uc29sZS5sb2coJ1Bvc3RpbmcgdG86ICcsIGAke3NlcnZlclVSTH0vbWVkaWFgKVxuXG4gICAgcmVxdWVzdC5vcGVuKCdwb3N0JywgYCR7c2VydmVyVVJMfS9tZWRpYWAsIHRydWUpXG5cbiAgICByZXF1ZXN0LnVwbG9hZC5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycsIChlKSA9PiB7XG4gICAgICBpZiAob25VcGxvYWRQcm9ncmVzcykge1xuICAgICAgICBvblVwbG9hZFByb2dyZXNzKGUubG9hZGVkIC8gZS50b3RhbClcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIChlcnJvcikgPT4ge1xuICAgICAgaWYgKHNpZ25hbCkge1xuICAgICAgICBzaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBvbkFib3J0KVxuICAgICAgfVxuICAgICAgcmVqZWN0KG5ldyBSZXRocm93bkVycm9yKGkxOG4udCgnZWRpdG9yOmVycm9ycy51cGxvYWRGYWlsZWQnKSwgZXJyb3IpKVxuICAgIH0pXG5cbiAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XG4gICAgICBpZiAoc2lnbmFsKSB7XG4gICAgICAgIHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCdhYm9ydCcsIG9uQWJvcnQpXG4gICAgICB9XG5cbiAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA8IDMwMCkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IEpTT04ucGFyc2UocmVxdWVzdC5yZXNwb25zZVRleHQpXG4gICAgICAgIHJlc29sdmUocmVzcG9uc2UpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZWplY3QobmV3IEVycm9yKGkxOG4udCgnZWRpdG9yOmVycm9ycy51cGxvYWRGYWlsZWQnLCB7IHJlYXNvbjogcmVxdWVzdC5zdGF0dXNUZXh0IH0pKSlcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKVxuICAgIGlmIChwcm9qZWN0SWQpIHtcbiAgICAgIGZvcm1EYXRhLnNldCgncHJvamVjdElkJywgcHJvamVjdElkKVxuICAgIH1cbiAgICBpZiAoZmlsZUlkZW50aWZpZXIpIHtcbiAgICAgIGZvcm1EYXRhLnNldCgnZmlsZUlkZW50aWZpZXInLCBmaWxlSWRlbnRpZmllcilcbiAgICB9XG5cbiAgICBmb3JtRGF0YS5zZXQoJ21lZGlhJywgYmxvYilcbiAgICByZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7dG9rZW59YClcblxuICAgIHJlcXVlc3Quc2VuZChmb3JtRGF0YSlcbiAgfSlcbn1cbi8qKlxuICogdXBsb2FkQXNzZXRzIHVzZWQgdG8gdXBsb2FkIGFzc2V0IGZpbGVzLlxuICpcbiAqIEBhdXRob3IgUm9iZXJ0IExvbmdcbiAqIEBwYXJhbSAge2FueX0gZWRpdG9yICAgICBbY29udGFpbnMgZWRpdG9yIGRhdGFdXG4gKiBAcGFyYW0gIHthbnl9IGZpbGVzICAgICAgW2ZpbGVzIGZvciB1cGxvYWRdXG4gKiBAcGFyYW0gIHthbnl9IG9uUHJvZ3Jlc3NcbiAqIEBwYXJhbSAge2FueX0gc2lnbmFsXG4gKiBAcmV0dXJuIHthbnl9ICAgICAgICAgICAgW3VwbG9hZGVkIGZpbGUgYXNzZXRzXVxuICovXG5leHBvcnQgY29uc3QgdXBsb2FkQXNzZXRzID0gYXN5bmMgKGVkaXRvciwgZmlsZXMsIG9uUHJvZ3Jlc3MsIHNpZ25hbCk6IFByb21pc2U8YW55PiA9PiB7XG4gIHJldHVybiBhd2FpdCBfdXBsb2FkQXNzZXRzKGAke3NlcnZlclVSTH0vc3RhdGljLXJlc291cmNlYCwgZWRpdG9yLCBmaWxlcywgb25Qcm9ncmVzcywgc2lnbmFsKVxufVxuLyoqXG4gKiBfdXBsb2FkQXNzZXRzIHVzZWQgYXMgYXBpIGhhbmRsZXIgZm9yIHVwbG9hZEFzc2V0LlxuICpcbiAqIEBhdXRob3IgUm9iZXJ0IExvbmdcbiAqIEBwYXJhbSAge2FueX0gIGVuZHBvaW50XG4gKiBAcGFyYW0gIHthbnl9ICBlZGl0b3JcbiAqIEBwYXJhbSAge2FueX0gIGZpbGVzXG4gKiBAcGFyYW0gIHthbnl9ICBvblByb2dyZXNzXG4gKiBAcGFyYW0gIHthbnl9ICBzaWduYWxcbiAqIEByZXR1cm4ge1Byb21pc2V9ICAgICAgICAgICAgW2Fzc2V0cyBmaWxlIGRhdGFdXG4gKi9cblxuZXhwb3J0IGNvbnN0IF91cGxvYWRBc3NldHMgPSBhc3luYyAoZW5kcG9pbnQsIGVkaXRvciwgZmlsZXMsIG9uUHJvZ3Jlc3MsIHNpZ25hbCk6IFByb21pc2U8YW55PiA9PiB7XG4gIGNvbnN0IGFzc2V0czogYW55W10gPSBbXVxuXG4gIGZvciAoY29uc3QgZmlsZSBvZiBBcnJheS5mcm9tKGZpbGVzKSkge1xuICAgIGlmIChzaWduYWwuYWJvcnRlZCkge1xuICAgICAgYnJlYWtcbiAgICB9XG5cbiAgICBjb25zdCBhYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKClcbiAgICBjb25zdCBvbkFib3J0ID0gKCkgPT4gYWJvcnRDb250cm9sbGVyLmFib3J0KClcbiAgICBzaWduYWwuYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBvbkFib3J0KVxuXG4gICAgY29uc3QgYXNzZXQgPSBhd2FpdCBfdXBsb2FkQXNzZXQoXG4gICAgICBlbmRwb2ludCxcbiAgICAgIGVkaXRvcixcbiAgICAgIGZpbGUsXG4gICAgICAocHJvZ3Jlc3MpID0+IG9uUHJvZ3Jlc3MoYXNzZXRzLmxlbmd0aCArIDEsIGZpbGVzLmxlbmd0aCwgcHJvZ3Jlc3MpLFxuICAgICAgYWJvcnRDb250cm9sbGVyLnNpZ25hbFxuICAgIClcblxuICAgIGFzc2V0cy5wdXNoKGFzc2V0KVxuICAgIHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCdhYm9ydCcsIG9uQWJvcnQpXG5cbiAgICBpZiAoc2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgIGJyZWFrXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGFzc2V0c1xufVxuLyoqXG4gKiB1cGxvYWRBc3NldCB1c2VkIHRvIHVwbG9hZCBzaW5nbGUgZmlsZSBhcyBhc3NldC5cbiAqXG4gKiBAYXV0aG9yIFJvYmVydCBMb25nXG4gKiBAcGFyYW0ge2FueX0gZWRpdG9yXG4gKiBAcGFyYW0ge2FueX0gZmlsZVxuICogQHBhcmFtIHthbnl9IG9uUHJvZ3Jlc3NcbiAqIEBwYXJhbSB7YW55fSBzaWduYWxcbiAqL1xuXG5leHBvcnQgY29uc3QgdXBsb2FkQXNzZXQgPSAoZWRpdG9yLCBmaWxlLCBvblByb2dyZXNzLCBzaWduYWwpOiBhbnkgPT4ge1xuICByZXR1cm4gX3VwbG9hZEFzc2V0KGAke3NlcnZlclVSTH0vc3RhdGljLXJlc291cmNlYCwgZWRpdG9yLCBmaWxlLCBvblByb2dyZXNzLCBzaWduYWwpXG59XG5cbi8qKlxuICogbWF0Y2hlc0ZpbGVUeXBlcyBmdW5jdGlvbiB1c2VkIHRvIG1hdGNoIGZpbGUgdHlwZSB3aXRoIGV4aXN0aW5nIGZpbGUgdHlwZXMuXG4gKlxuICogQGF1dGhvciBSb2JlcnQgTG9uZ1xuICogQHBhcmFtICB7T2JqZWN0fSBmaWxlICAgICAgW29iamVjdCBjb250YWlucyBmaWxlIGRhdGFdXG4gKiBAcGFyYW0gIHthcnJheX0gZmlsZVR5cGVzIFtBcnJheSBjb250YWlucyBleGlzdGluZyBmaWxlIHR5cGVzXVxuICogQHJldHVybiB7Ym9vbGVhbn0gICAgICAgICAgIFt0cnVlIGlmIGZpbGUgdHlwZSBmb3VuZCBpbiBleGlzdGluZyBmaWxlVHlwZXNdXG4gKi9cblxuZXhwb3J0IGZ1bmN0aW9uIG1hdGNoZXNGaWxlVHlwZXMoZmlsZSwgZmlsZVR5cGVzKSB7XG4gIGZvciAoY29uc3QgcGF0dGVybiBvZiBmaWxlVHlwZXMpIHtcbiAgICBpZiAocGF0dGVybi5zdGFydHNXaXRoKCcuJykpIHtcbiAgICAgIGlmIChmaWxlLm5hbWUudG9Mb3dlckNhc2UoKS5lbmRzV2l0aChwYXR0ZXJuKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZmlsZS50eXBlLnN0YXJ0c1dpdGgocGF0dGVybikpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZVxufVxuXG4vKipcbiAqIHVwbG9hZFByb2plY3RBc3NldCB1c2VkIHRvIGNhbGwgX3VwbG9hZEFzc2V0IGRpcmVjdGx5LlxuICpcbiAqIEBhdXRob3IgUm9iZXJ0IExvbmdcbiAqIEBwYXJhbSB7YW55fSBlZGl0b3JcbiAqIEBwYXJhbSB7YW55fSBwcm9qZWN0SWRcbiAqIEBwYXJhbSB7YW55fSBmaWxlXG4gKiBAcGFyYW0ge2FueX0gb25Qcm9ncmVzc1xuICogQHBhcmFtIHthbnl9IHNpZ25hbFxuICovXG5cbmV4cG9ydCBjb25zdCB1cGxvYWRQcm9qZWN0QXNzZXQgPSAoZWRpdG9yLCBwcm9qZWN0SWQsIGZpbGUsIG9uUHJvZ3Jlc3MsIHNpZ25hbCk6IGFueSA9PiB7XG4gIHJldHVybiBfdXBsb2FkQXNzZXQoYCR7c2VydmVyVVJMfS9wcm9qZWN0LyR7cHJvamVjdElkfS9hc3NldHNgLCBlZGl0b3IsIGZpbGUsIG9uUHJvZ3Jlc3MsIHNpZ25hbClcbn1cbi8qKlxuICogX3VwbG9hZEFzc2V0IHVzZWQgYXMgYXBpIGhhbmRsZXIgZm9yIHRoZSB1cGxvYWRBc3NldC5cbiAqXG4gKiBAYXV0aG9yIFJvYmVydCBMb25nXG4gKiBAcGFyYW0gIHthbnl9ICBlbmRwb2ludFxuICogQHBhcmFtICB7YW55fSAgZWRpdG9yXG4gKiBAcGFyYW0gIHthbnl9ICBmaWxlXG4gKiBAcGFyYW0gIHthbnl9ICBvblByb2dyZXNzXG4gKiBAcGFyYW0gIHthbnl9ICBzaWduYWxcbiAqIEByZXR1cm4ge1Byb21pc2V9ICAgICAgICAgICAgW3VwbG9hZGVkIGFzc2V0IGZpbGUgZGF0YV1cbiAqL1xuXG5leHBvcnQgY29uc3QgX3VwbG9hZEFzc2V0ID0gYXN5bmMgKGVuZHBvaW50LCBlZGl0b3IsIGZpbGUsIG9uUHJvZ3Jlc3MsIHNpZ25hbCk6IFByb21pc2U8YW55PiA9PiB7XG4gIGxldCB0aHVtYm5haWxGaWxlSWQgPSBudWxsXG4gIGxldCB0aHVtYm5haWxBY2Nlc3NUb2tlbiA9IG51bGxcblxuICBpZiAoIW1hdGNoZXNGaWxlVHlwZXMoZmlsZSwgWy4uLkF1ZGlvRmlsZVR5cGVzLCAuLi5DdXN0b21TY3JpcHRGaWxlVHlwZXNdKSkge1xuICAgIGNvbnN0IHRodW1ibmFpbEJsb2IgPSBhd2FpdCBlZGl0b3IuZ2VuZXJhdGVGaWxlVGh1bWJuYWlsKGZpbGUpXG5cbiAgICBjb25zdCByZXNwb25zZSA9IChhd2FpdCB1cGxvYWQodGh1bWJuYWlsQmxvYiwgdW5kZWZpbmVkLCBzaWduYWwpKSBhcyBhbnlcblxuICAgIHRodW1ibmFpbEZpbGVJZCA9IHJlc3BvbnNlLmZpbGVfaWRcbiAgICB0aHVtYm5haWxBY2Nlc3NUb2tlbiA9IHJlc3BvbnNlLm1ldGEuYWNjZXNzX3Rva2VuXG4gIH1cblxuICBjb25zdCB7XG4gICAgZmlsZV9pZDogYXNzZXRGaWxlSWQsXG4gICAgbWV0YTogeyBhY2Nlc3NfdG9rZW46IGFzc2V0QWNjZXNzVG9rZW4sIGV4cGVjdGVkX2NvbnRlbnRfdHlwZTogZXhwZWN0ZWRDb250ZW50VHlwZSB9LFxuICAgIG9yaWdpbjogb3JpZ2luXG4gIH0gPSAoYXdhaXQgdXBsb2FkKGZpbGUsIG9uUHJvZ3Jlc3MsIHNpZ25hbCkpIGFzIGFueVxuXG4gIGNvbnN0IGRlbHRhID0gRGF0ZS5ub3coKSAtIGxhc3RVcGxvYWRBc3NldFJlcXVlc3RcblxuICBpZiAoZGVsdGEgPCAxMTAwKSB7XG4gICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTEwMCAtIGRlbHRhKSlcbiAgfVxuXG4gIGNvbnN0IHRva2VuID0gZ2V0VG9rZW4oKVxuXG4gIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgJ2NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICBhdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YFxuICB9XG5cbiAgY29uc3QgYm9keSA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICBhc3NldDoge1xuICAgICAgbmFtZTogZmlsZS5uYW1lLFxuICAgICAgZmlsZV9pZDogYXNzZXRGaWxlSWQsXG4gICAgICBhY2Nlc3NfdG9rZW46IGFzc2V0QWNjZXNzVG9rZW4sXG4gICAgICB0aHVtYm5haWxfZmlsZV9pZDogdGh1bWJuYWlsRmlsZUlkLFxuICAgICAgdGh1bWJuYWlsX2FjY2Vzc190b2tlbjogdGh1bWJuYWlsQWNjZXNzVG9rZW5cbiAgICB9XG4gIH0pXG5cbiAgbGFzdFVwbG9hZEFzc2V0UmVxdWVzdCA9IERhdGUubm93KClcblxuICByZXR1cm4ge1xuICAgIGlkOiBhc3NldEZpbGVJZCxcbiAgICBuYW1lOiBmaWxlLm5hbWUsXG4gICAgdXJsOiBvcmlnaW4sXG4gICAgdHlwZTogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gICAgaW1hZ2VzOiB7XG4gICAgICBwcmV2aWV3OiB7IHVybDogZmlsZS50aHVtYm5haWxfdXJsIH1cbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJpMThuIl0sIm1hcHBpbmdzIjoiNEZBQXVDLEVBQU8sSUFDeEMsQ0FBQyxRQUFjLE1BQ2YsRUFBTSxjQUFnQixHQUFNLGFBQzFCLEdBQVMsRUFBTSxhQUNqQixHQUNFLEVBQU0sT0FBTyxPQUFTLEVBQU0sT0FBTyxNQUFNLFFBQWdCLEVBQU8sTUFBTSxRQUN0RSxFQUFNLE9BQU8sSUFBWSxtQkFBbUIsRUFBTyxPQUNuRCxZQUFrQixnQkFDYixrQkFBa0IsRUFBTyxRQUFVLHFCQUN4QyxFQUFPLFlBQWMsMENBR2xCLG9CQUFvQixLQUV0QixtQkFBbUIsS0FBSyxVQUFVLHFCQUdaLE1BQU0sQ0FDbkMsWUFBWSxFQUFTLE9BQ2IsUUFDRCxLQUFPLEtBQUssWUFBWSxVQUN4QixRQUFVLEVBQ1gsTUFBTyxPQUFNLG1CQUFzQixpQkFDL0Isa0JBQWtCLEtBQU0sS0FBSyxrQkFFOUIsTUFBUSxHQUFJLE9BQU0sR0FBUyxzQkFLSCxFQUFVLENBQzNDLGNBQ0EsWUFBWSxFQUFTLEVBQU8sT0FDcEIsR0FBRztBQUFBO0FBQUEsTUFBMkIsRUFBZSxHQUFPLFFBQVEsTUFBTztBQUFBLGVBQ3BFLGNBQWdCLE9BQ2hCLE9BQVM7QUFBQSxFQUFPLEVBQU0sWUN6QmxCLEdBQVcsSUFBYyxNQUM5QixHQUFRLGFBQWEsUUFBUSxFQUFPLG9CQUFvQixxQkFFMUQsR0FBUyxNQUFRLEVBQU0sU0FBVyxPQUM5QixJQUFJLE9BQU1BLEVBQUssRUFBRSx5Q0FHbEIsSUNYSCxFQUFZLEVBQU8sb0JBQW9CLFVBZ0JoQyxFQUFTLE1BQU8sRUFBTSxFQUFrQixFQUFTLEVBQWlCLElBQThCLE1BQ3JHLEdBQVEsVUFFUCxNQUFNLElBQUksU0FBUSxDQUFDLEVBQVMsSUFBVyxNQUN0QyxHQUFVLEdBQUksZ0JBQ2QsRUFBVSxJQUFNLEdBQ1osYUFDRixHQUFRLEdBQUksT0FBTUEsRUFBSyxFQUFFLGtDQUN6QixLQUFPLGVBQ1AsUUFBYSxLQUNaLElBR0wsS0FDSyxpQkFBaUIsUUFBUyxXQUUzQixJQUFJLGVBQWdCLEdBQUcsYUFFdkIsS0FBSyxPQUFRLEdBQUcsVUFBbUIsTUFFbkMsT0FBTyxpQkFBaUIsV0FBWSxBQUFDLEdBQU0sQ0FDN0MsS0FDZSxFQUFFLE9BQVMsRUFBRSxXQUkxQixpQkFBaUIsUUFBUyxBQUFDLEdBQVUsQ0FDdkMsS0FDSyxvQkFBb0IsUUFBUyxLQUUvQixHQUFJLEdBQWNBLEVBQUssRUFBRSw4QkFBK0IsUUFHekQsaUJBQWlCLE9BQVEsSUFBTSxJQUNqQyxLQUNLLG9CQUFvQixRQUFTLEdBR2xDLEVBQVEsT0FBUyxJQUFLLE1BQ2xCLEdBQVcsS0FBSyxNQUFNLEVBQVEsZ0JBQzVCLFVBRUQsR0FBSSxPQUFNQSxFQUFLLEVBQUUsNkJBQThCLENBQUUsT0FBUSxFQUFRLHNCQUl0RSxHQUFXLEdBQUksVUFDakIsS0FDTyxJQUFJLFlBQWEsR0FFeEIsS0FDTyxJQUFJLGlCQUFrQixLQUd4QixJQUFJLFFBQVMsS0FDZCxpQkFBaUIsZ0JBQWlCLFVBQVUsT0FFNUMsS0FBSyJ9
